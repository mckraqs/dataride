# Sample AWS S3 storage structure
#
# Creates a structure that consists of:
# - AWS S3 buckets
#   - dataride-bucket-data
#   - dataride-bucket-logs
# - AWS S3 subdirectory
#   - dataride-bucket-logs/main-logs

providers:
  - aws:
      region: eu-central-1
envs:
  prod:
    versioning:
      is_variable: true
      type: string
    # Backend definition skipped on purpose, to see default one
  test:
    versioning:
      is_variable: true
      default_value: false
      type: string
    backend:
      type: local
      options:
        path: "relative/path/to/terraform.tfstate"
resources:
  - aws_s3:
      _module: storage
      resource_name: data_bucket
      bucket_name: dataride-bucket-data
      versioning:
        is_variable: true
        type: bool
  - aws_s3:
      _module: storage
      resource_name: logs_bucket
      bucket_name: dataride-bucket-logs
  - aws_s3_directory:
      _module: storage
      resource_name: s3_logs_directory
      bucket: dataride-bucket-logs
      key: "main-logs"
